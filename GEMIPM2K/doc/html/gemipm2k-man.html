<!DOCTYPE doctype PUBLIC "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
  <meta http-equiv="Content-Type"
 content="text/html; charset=iso-8859-1">
  <meta name="GENERATOR"
 content="Mozilla/4.7 [en] (WinNT; I) [Netscape]">
  <title>GEMIPM2K Description</title>
  <meta name="description" content="Version 3.0.0-PSI">
</head>
<body>
<h1><img alt="GEMS-icon" src="gems1.png"
 style="width: 48px; height: 48px;" align="left"> <font color="#000066">
GEMIPM2K version 2.2.3</font> </h1>
<h2>Standalone GEM-IPM-2 Solver of Chemical Equilibria by Gibbs Energy
Minimization<br>
</h2>
<hr size="2" width="100%">
<p> </p>
<h3><span style="color: rgb(255, 0, 0);">&lt;under construction&gt;</span><br>
</h3>
<h3>Contents</h3>
<blockquote>
  <p><font face="Helvetica, Arial, sans-serif"><a href="#1-INTRO">1.
Introduction<br>
  </a></font></p>
  <p><font face="Helvetica, Arial, sans-serif"><a href="#2-STRUCTURE">2.
Structure of GEMIPM2K Code&nbsp; and its Data Exchange Intefaces <br>
  </a></font></p>
  <p><a href="#IPM2-OPERATION"><font face="Helvetica, Arial, sans-serif">2.1.
Brief overview of GEM IPM2 module operation</font></a></p>
  <p><font face="Helvetica, Arial, sans-serif"><a href="#KERNEL">2.2.
The GEM-IPM2 Kernel (GEMIPM2K) and its Work Data Structure IPM (Multi) </a><br>
  </font></p>
  <p><a href="#DATACH"><font face="Helvetica, Arial, sans-serif">2.3.
The DATACH Structure for Chemical System Definition (CSD)<br>
  </font></a></p>
  <p><font face="Helvetica, Arial, sans-serif"><a href="#DATABR">2.4.
The DATABR Structure for the Node Data Bridge Composition and
Speciation data</a> <br>
  <br>
  </font><font face="Helvetica, Arial, sans-serif"> <a href="#TNODE">2.5.
The TNode Class - a Minimal Data Exchange
Interface for Coupling with Existing Transport Codes</a><br>
  </font><font face="Helvetica, Arial, sans-serif"><br>
  <a href="#TNODEARRAY">2.6. The TNodeArray Class - a Node Data Storage
for Developing New Coupled Codes</a><br>
  </font></p>
  <p><font face="Helvetica, Arial, sans-serif"><a
 href="#NUMERICAL_CONTROLS">2.7. Numerical controls of GEMIPM2K
operation</a><br>
  </font> </p>
  <p><font face="Helvetica, Arial, sans-serif"><a href="#REQUIREMENTS">3.
Requirements for Programming </a><br>
  </font></p>
  <p><font face="Helvetica, Arial, sans-serif"><a href="#CALLFROMCPP">3.1.
When the Calling (FMT)
Program is Written in C++</a><br>
  </font><font face="Helvetica, Arial, sans-serif"><br>
  <a href="#CALLFROMFORTRAN">3.2. When the Calling (FMT) Program is
Written in Fortran-90 </a></font><br>
  </p>
  <p><font face="Helvetica, Arial, sans-serif"><a href="#ALPHABETICAL">4.
Compilation and Linking of GEMIPM2K on Various Platforms</a><br>
  </font></p>
  <p><font face="Helvetica, Arial, sans-serif"><a href="#GNUCPP_FOR">4.1.
GNU C++ (gcc - gfortran)</a><br>
  </font></p>
  <p><font face="Helvetica, Arial, sans-serif"><a href="#PGICPP_FOR">4.2.
Portland Group C++ (pgcc- pgf)</a><br>
  </font></p>
  <p><font face="Helvetica, Arial, sans-serif"><a href="#MSVCPP_DIGIFOR">4.3.
MS Visual C++ (with Digital Fortran)</a><br>
  </font></p>
  <p><font face="Helvetica, Arial, sans-serif"><a href="#BORLANDCPP">4.4.
Borland C++</a><br>
  </font></p>
  <p><font face="Helvetica, Arial, sans-serif"><a
 href="#OTHER_COMPILERS">4.5. Other compilers and linkers</a><br>
  </font></p>
  <p><font face="Helvetica, Arial, sans-serif"><a href="#SVN_REP">4.6.
Subversion Repository of GEMIPM2K</a><br>
  </font></p>
  <p><font face="Helvetica, Arial, sans-serif"><a href="#INPUT_FILES">5.
Input Files</a><br>
  </font></p>
  <p><font face="Helvetica, Arial, sans-serif"><a href="#TEST_EXAMPLES">6.
Test Examples</a><br>
  </font></p>
  <p><font face="Helvetica, Arial, sans-serif"><a href="#TEST_TNODE">6.1.
TNode Level</a><br>
  </font></p>
  <p><font face="Helvetica, Arial, sans-serif"><a
 href="#TEST_TNODEARRAY">6.2. TNodeArray Level</a><br>
  <a href="gemipm2k-man.html#FREEDATA"> </a></font></p>
  <p style="font-family: Helvetica,Arial,sans-serif;"><a
 href="#REFERENCES">7. References</a></p>
  <br>
  <hr size="2" width="100%"><br>
  <h2><a name="1-INTRO"></a>1. Introduction</h2>
  <p></p>
  <p style="font-family: Helvetica,Arial,sans-serif;">Modern
approaches to reactive mass transport (RMT) or fluid mass transport
(FMT) modelling require simultaneous account for the mass transport of
contaminants through aqueous and/or gas phase in subsurface, together
with their
interaction with wall-rock minerals by means of (ad)sorption,
mineral (co)precipitation, dissolution, etc.&nbsp; These chemical
processes depend on the redox state of the system, are inherently
complex,
and may involve many phases and chemical species, some of which are
kinetically dependent. Such interactions may indirectly affect the mass
transport
via the porosity and permeability changes e.g. due to mineral
dissolution or
precipitation. </p>
  <p style="font-family: Helvetica,Arial,sans-serif;">Direct
inclusion of all possible chemical reactions in the mass transport
model may render it intractable in 2D or 3D space.
If this is the case, the chemical model must be dramatically simplified
to a
few reactions, which makes its chemical plausibility doubtful. The
modeller must make (often arbitrary) decisions which chemical
interactions are relevant and which can be neglected. <br>
  </p>
  <p style="font-family: Helvetica,Arial,sans-serif;">An
alternative approach would be to keep a complex enough chemical model
in a kind of "black box" which can be applied separately to each
node of the FMT model at each given time point <span
 style="font-style: italic;">t</span>.&nbsp; The&nbsp; input of
the "chemical black box" at time <span style="font-style: italic;">t</span>&nbsp;
is just the vector of bulk chemical composition <span
 style="font-style: italic;">b</span>
of the reactive part of the node, as well as temperature <span
 style="font-style: italic;">T</span>, pressure <span
 style="font-style: italic;">P</span>, and optionally, kinetic
constraints <span style="font-style: italic;">k</span> on some
reactions or amounts of certain components. Some or all of these inputs
could have been changed by the mass transport part on its previous
iteration time step <span style="font-style: italic;">t-</span>1.&nbsp;
  <br>
  </p>
  <p style="font-family: Helvetica,Arial,sans-serif;">Now, the
"chemical black box" equilibration is applied
to each node independently at time point <span
 style="font-style: italic;">t</span>,
to produce changed speciation <span style="font-style: italic;">n</span>
(amounts of chemical species in all reactive
phases),&nbsp; new phase volumes, redox (Eh, pe of aqueous solution,
gas fugacities), chemical potentials of components, etc. This
procedure can also detect a disappearance of some phases or
appearance of some new phases in some nodes (e.g., by dissolution or
precipitation of solids). <br>
  </p>
  <p style="font-family: Helvetica,Arial,sans-serif;">After the
"chemistry" run over all nodes is
finished, the next time step of the FMT algorithm can be done for the
time point <span style="font-style: italic;">t</span>+1, using the
updated concentrations of mobile species (also pH, Eh, f(H2), ... ) in
aqueous
and/or gas phases at time <span style="font-style: italic;">t.</span>
The FMT part redistributes matter between nodes (under mass
concervation), thus producing corrected compositions of reactive part
of
each node. So, the coupled RMT algorithm actually runs over all nodes
twice at the time point <span style="font-style: italic;">t</span>:&nbsp;
once doing a mass transport iteration using node compositions obtained
earlier (at <span style="font-style: italic;">t</span>-1), and
then&nbsp; by applying the "chemical black box" to each node at time <span
 style="font-style: italic;">t</span>, producing the updated speciation
which will be used by the FMT part at the next time point&nbsp; <span
 style="font-style: italic;">t</span>+1.</p>
  <p style="font-family: Helvetica,Arial,sans-serif;">This
idea of "reactor-splitting" coupling is not really new and it has
already been implemented in a number of
coupled codes (PHREEQC, RockFlow, MCOTAC, ....). These codes
use different mass transport algorithms, but in most cases the same
type of chemical
solver based on the law of mass action (LMA) and the Newton-Raphson
method
for minimizing the mass balance deviations. However, another type of
chemical solvers based on Gibbs energy minimization (GEM) can also
be&nbsp;
coupled with the FMT codes. </p>
  <p style="font-family: Helvetica,Arial,sans-serif;">Both LMA and
GEM can solve the so-called&nbsp; forward
chemical modeling problem, which consists in finding
concentrations (or
amounts) and activities of chemical species in aqueous and other phases
present
in a complex chemical system in an equilibrium state defined by
temperature <span style="font-style: italic;">T</span>, pressure <span
 style="font-style: italic;">P</span>, and the
system bulk composition <span style="font-style: italic;">b</span>. In
practice, calculations for
solving such problems range from trivial to complex,
depending on
the number of species, phases, and stoichiometry units. The complexity
further
increases when several phases-solutions with redox sensitive components
are
included in the mass balance; a typical case is the aqueous - solid
solution (Aq-SS) system which also involves a non-ideal fluid (gas
mixture) phase. Even more complex systems can be considered, e.g. those
involving (ad)sorption on several co-existing stable or metastable
sorbents. </p>
  <p style="font-family: Helvetica,Arial,sans-serif;">Chemical
speciation problems were traditionally solved with help of the LMA
codes,
supported with tools for calculation of
Lippmann functions and saturation indexes. A good introduction
into modern LMA chemical speciation numerical
methods can be found in several textbooks [<a
 href="#Ref_Van-Zeggeren-1970">Van Zeggeren and Storey,
1970</a>; <a href="#Ref_Morel-Hering-1993">Morel and Hering, 1993</a>;
  <a href="#Ref_Bethke-1996">Bethke, 1996</a>] and in the manuals of
speciation codes such as PHREEQC [<a href="#Ref_Parkhurst-Appelo-1999">Parkhurst
and Appelo, 1999</a>] or CHESS
[<a href="#Ref_van-der-Lee-1998">van der Lee, 1998</a>]. <br>
  </p>
  <p style="font-family: Helvetica,Arial,sans-serif;">The
advantages of LMA - excellent mass balance accuracy and fast
convergence - are best revealed in the case of simple aqueous
speciation models with known stable pure solid phase assemblage and
known Eh and fugacities of gases. The LMA codes require thermodynamic
data only for the product species (usually aqueous/surface complexes,
minerals, and gases), but not for the master species (usually aqueous
ions) - this "input data economy" can also be viewed as an advantage in
some cases.<br>
  <br>
  <a name="CRITIQUE-LMA"></a>However,
solving with LMA code complex equilibria that involve the aqueous
electrolyte phase, many possible condensed phases including solid
solutions or fluids is,
in general, an inefficient and awkward process. Different approaches
are used in LMA chemical solvers. In the Geochemists Workbench [<a
 href="#Ref_Bethke-1996">Bethke,1996</a>],&nbsp; any pure mineral phase
is taken as master species. Because there is no way to mix master
species, this program cannot handle solid solutions or gas mixture at
all. Other LMA codes (such as PHREEQC) consider minerals and gases as
product species. As pointed by [<a href="#Ref_Reed-1982">Reed, 1982</a>],
usually no solids are taken into mass balance in the initial speciation
calculation; after it is done, the saturation indexes are computed for
each stoichiometrically feasible mineral phase, the mineral with the
highest oversaturation is included into the mass balance, the
speciation is computed again, and this loop is repeated until no
supersaturated phases are left in the list. <br>
  </p>
  <p style="font-family: Helvetica,Arial,sans-serif;">The real problem
in LMA approach is how to determine the saturation index of the solid
solution
phase or the gas mixture. For the ideal (solid) solution, this can be
done over iterations using ionic mole fractions
available from aqueous speciation. For non-ideal SS, this is a problem
which has
no general solution, as explained on Page 94 in [<a
 href="#Ref_Bruno_ea_2007">Bruno et al, 2007</a>]. Because of that, the
LMA chemical solvers can at best treat only ideal solution phases and
simple binary non-ideal solid solutions that can be described using
Lippmann functions and diagrams. If many solids and/or solid solutions
are potentially present,&nbsp; a simple LMA aqueous
speciation calculation turns into a series of many runs controlled by
non-rigorous
test procedures for selecting (over)saturated solids one-by-one,
without a theoretical guarantee of
convergence to a unique result. This kind of retardation is difficult
to evaluate, but, with a large list of possible condensed phases, more
than ten LMA sub-runs may be required to include all stable solids
into
mass balance.&nbsp;<br>
  </p>
<!--[if gte vml 1]><v:shapetype
 id="_x0000_t75" coordsize="21600,21600" o:spt="75" o:preferrelative="t"
 path="m@4@5l@4@11@9@11@9@5xe" filled="f" stroked="f">
 <v:stroke joinstyle="miter"/>
 <v:formulas>
  <v:f eqn="if lineDrawn pixelLineWidth 0"/>
  <v:f eqn="sum @0 1 0"/>
  <v:f eqn="sum 0 0 @1"/>
  <v:f eqn="prod @2 1 2"/>
  <v:f eqn="prod @3 21600 pixelWidth"/>
  <v:f eqn="prod @3 21600 pixelHeight"/>
  <v:f eqn="sum @0 0 1"/>
  <v:f eqn="prod @6 1 2"/>
  <v:f eqn="prod @7 21600 pixelWidth"/>
  <v:f eqn="sum @8 21600 0"/>
  <v:f eqn="prod @7 21600 pixelHeight"/>
  <v:f eqn="sum @10 21600 0"/>
 </v:formulas>
 <v:path o:extrusionok="f" gradientshapeok="t" o:connecttype="rect"/>
 <o:lock v:ext="edit" aspectratio="t"/>
</v:shapetype><v:shape id="_x0000_i1025" type="#_x0000_t75" style='width:15pt;
 height:20.25pt' o:ole="">
 <v:imagedata src="file:///C:\DOCUME~1\KULIK~1.PSI\LOCALS~1\Temp\msohtml1\01\clip_image001.wmz"
  o:title=""/>
</v:shape><![endif]--><!--[if !vml]--><!--[endif]--><!--[if gte mso 9]><xml>
 <o:OLEObject Type="Embed" ProgID="Equation.3" ShapeID="_x0000_i1025"
  DrawAspect="Content" ObjectID="_1230310185">
 </o:OLEObject>
</xml><![endif]-->
  <p style="font-family: Helvetica,Arial,sans-serif;">These drawbacks
of LMA approach are not relevant in a
complementary GEM approach [for details, see <a
 href="#Ref_Karpov-ea-1997">Karpov et
al., 1997</a>; <a href="#Ref_Karpov-ea-2001">2001</a>; <a
 href="#Ref_Kulik-ea-2004">Kulik et al., 2004</a>; <a
 href="#Ref_Bruno_ea_2007">Bruno et al., 2007</a>], where total mole
amounts of
chemical
elements <span style="font-style: italic;">n<sub>i</sub></span><sub> </sub>and
(zero)
charge <span style="font-style: italic;">n<sub>z</sub></span> comprise
the
input bulk composition of the chemical system expressed using <span
 style="font-style: italic;">n</span>(<span style="font-style: italic;">N</span>)
independent components
(IC). All&nbsp; <span style="font-style: italic;">n</span>(<span
 style="font-style: italic;">L</span>) stoichiometrically
feasible chemical species or dependent
components (DC) are taken
into the mass balance
through their chemical formulae and mole amounts <span
 style="font-style: italic;">n<sub>j</sub></span>. A given <span
 style="font-style: italic;">j</span>-th dependent
component belongs to a single- or
multi-component aqueous, gaseous, fluid, liquid, solid, or sorption
phase.
The stability of <span style="font-style: italic;">j</span>-th DC at
temperature <span style="font-style: italic;">T</span> and pressure <span
 style="font-style: italic;">P</span>
of
interest is defined by its molar Gibbs energy function <span
 style="font-style: italic;">g<sub>T,P</sub></span>. Activities and
concentrations
of dependent components are treated separately in each phase, taking
into account the appropriate standard and
reference states, concentration scales, and models of (non)ideal
mixing. </p>
  <p style="font-family: Helvetica,Arial,sans-serif;">Conversely,
GEM
algorithms can solve complex Aq-SS
equilibria in one GEM run, in a
straightforward way, without any supporting tools such as Lippmann
functions or semi-empirical iterative procedures required in LMA Aq-SS
speciation
models. The applicability of GEM to chemical systems is limited only by
the knowledge of
standard-state molar properties of end-members and the non-ideal
interaction
parameters for each phase.</p>
  <p style="font-family: Helvetica,Arial,sans-serif;">The
disadvantages of GEM in comparison with LMA codes are (i) slower
convergence in simple aqueous speciation calculations
and (ii) less mass balance accuracy. The performance of GEM can be
dramatically improved using the previous equilibrium speciation as an
initial approximation
for the new run (in "smart initial approximation" mode). The mass
balance accuracy can be made comparable to that of LMA at the cost of a
few additional
GEM iterations (the IPM-2 algorithm), as described in [<a
 href="#Ref_TM-44-02-06">Chudnenko ea,
2002</a>]. </p>
  <p style="font-family: Helvetica,Arial,sans-serif;">Performance and
chemical feasibility of GEM in complex Aq-SS multiphase
systems may be much better than that of LMA codes
(though no
direct benchmarking is yet available). Another advantage of
GEM method (in "convex programming" variant) is that it yields two
solutions - the "primal" <span style="font-style: italic;">n</span>
for speciation
(analogous to LMA) and the "dual" <span style="font-style: italic;">u</span>
for chemical potentials of
stoichiometry units (not available from LMA solvers). The dual solution
may open
innovative ways to constructing mass transport models for
diffusion-dominated systems, since the
diffusion of any component is driven by the gradient of its chemical
potential.</p>
  <p style="font-family: Helvetica,Arial,sans-serif;">The
present program package GEMIPM2K is an implementation of GEM IPM-2
chemical
solver with a simple data exchange interface that makes it possible to
couple any existing FMT code with the GEM&nbsp; "chemical black box" to
produce a coupled modeling code with high chemical plausibility. As
there is no GUI and data exchange occurs via files or in RAM, such code
can be parallelized and compiled on various platforms up to HPC
clusters.&nbsp; <br>
  </p>
  <p style="font-family: Helvetica,Arial,sans-serif;">The traditional
"operator-splitting" coupling, where the chemical information for all
nodes is
stored in the mass transport part which calls the chemical solver for
each node one-by-one, is
supported by the TNode C++ class (and its fortran interface). When a
new FMT code is written, the whole data storage for all nodes can be
organized using a TNodeArray C++ class into two node arrays (for time t
and t-1), with each node accessible
from the GEM IPM-2 routines or from the FMT program. </p>
  <p style="font-family: Helvetica,Arial,sans-serif;">This
document describes the structure of GEMIPM2K program and the data
exchange interface (DATACH and DATABR structures), followed by an
overview of TNode and TNodeArray classes and examples of their
usage. In a companion document <a href="gemipm2k-inp.html">gemipm2k-inp.html</a>,
the format of GEMIPM2K text input/output files is described together
with the reference on data objects encountered in these files. Most of
these data objects are the same as in GEM-Selektor; hyperlinks are
provided wherever necessary. <br>
  </p>
  <p><br>
  </p>
  <hr size="2" width="100%">
  <h2><br>
  </h2>
  <h2><a name="2-STRUCTURE"></a>2. Structure of GEMIPM2K Code and
its Data Exchange Inteface </h2>
  <p style="font-family: Helvetica,Arial,sans-serif;"><span
 style="font-size: 12pt; font-family: Helvetica,Arial,sans-serif;">GEMIPM2K
package is a set of C++ classes and functions
extracted from the <st1:stockticker w:st="on">GEMS</st1:stockticker>-<st1:stockticker
 w:st="on">PSI</st1:stockticker> code package for thermodynamic
modelling by Gibbs energy minimization (<st1:stockticker w:st="on">GEM</st1:stockticker>).
GEMIPM2K implements the GEM chemical solver linked to TMulti C++ class
and data structure, enhanced with <st1:stockticker w:st="on">RAM</st1:stockticker>-
and file- data exchange interfaces implemented in TNode and TNodeArray
classes. <br>
  </span></p>
  <p style="font-family: Helvetica,Arial,sans-serif;"><span
 style="font-size: 12pt; font-family: Helvetica,Arial,sans-serif;"><st1:stockticker
 w:st="on"></st1:stockticker> GEMIPM2K has been designed for
coupling the <st1:stockticker w:st="on">GEM</st1:stockticker> chemical
solver with
existing and new fluid-mass-transport (<st1:stockticker w:st="on">FMT</st1:stockticker>)
codes. The program source code is compatible with <st1:stockticker
 w:st="on">ANSI</st1:stockticker>
C++ and can be compiled on many computer platforms (Windows, Linux, <st1:stockticker
 w:st="on">HPC</st1:stockticker> Merlin, Cray XT, etc.) using many
optimizing
compilers (GNU C++, <st1:stockticker w:st="on">PGI</st1:stockticker>
C++, Intel
C++, Microsoft C++, &#8230; ). <br>
  </span></p>
  <p style="font-family: Helvetica,Arial,sans-serif;"><span
 style="font-size: 12pt; font-family: Helvetica,Arial,sans-serif;">The
input data can be provided in human-readable ASCII files, the
output can also be written in ASCII files. Alternatively, the whole
data
exchange with a transport code part can be performed in <st1:stockticker
 w:st="on">RAM</st1:stockticker>
using&nbsp; DATACH
and&nbsp; DATABR data structures.
This data exchange interface is implemented in two C++ classes &#8211; TNode
and TNodeArray. <br>
  </span></p>
  <p style="font-family: Helvetica,Arial,sans-serif;"><span
 style="font-size: 12pt; font-family: Helvetica,Arial,sans-serif;">The
TNode class provides functionality for attaching GEMIPM2K
kernel to an existing transport model code which keeps the chemical
information
for all nodes and calls <st1:stockticker w:st="on">GEM</st1:stockticker>
calculation for each node separately. The TNodeArray class is built on
top of the TNode class and can store both chemical and dynamic data
for all nodes of the mass transport problem. Recalculation of
equilibrium
states in all nodes after the mass transport step can be done with a
single call (with
internal parallelization possible). This may be suitable for developing
of a
new coupled code. The GEMIPM2K source code is expected to be
distributed under
LGPL or similar license.<br>
  <br style="font-family: Helvetica,Arial,sans-serif;">
  </span></p>
  <h3><a name="IPM2-OPERATION"></a>2.1. Brief overview of GEM IPM2
module operation<br>
  </h3>
  <p style="font-family: Helvetica,Arial,sans-serif;">The GEM IPM2
algorithm is described in a companion PSI Technical Report [<a
 href="#Ref_Kulik_ea-2008">Kulik et
al., 2008</a>] , as well as in earlier report [<a
 href="#Ref_TM-44-02-06">Chudnenko et al., 2002</a>]. A short overview
is given in [<a href="#Ref_Bruno_ea_2007">Bruno et al., 2007</a>],
pages 94-104. Recently, the speed of GEM IPM-2 calculations has been
dramatically increased [<a href="#Ref_Dmytrieva-2008">Dmytrieva et al.,
2008</a>] and now is comparable with that of LMA codes, at least in
"smart initial approximation" mode. <br>
  </p>
  <p style="font-family: Helvetica,Arial,sans-serif;">The basic idea of
the GEM IPM algorithm consists in finding such a distribution vector <span
 style="font-style: italic;">n </span>of bulk chemical composition of
the system <span style="font-style: italic;">b</span> over its
thermodynamic phases and their components that the total Gibbs energy <span
 style="font-style: italic;">G</span>(<span style="font-style: italic;">n</span>)
of the system is at minimum at temperature and pressure of interest.
Each phase component (chemical species) is represented by its
stoichiometry and the standard chemical potential (molar Gibbs energy
function <span style="font-style: italic;">g</span><sup>o</sup>(<span
 style="font-style: italic;">T,P</span>)) at temperature <span
 style="font-style: italic;">T</span> and pressure <span
 style="font-style: italic;">P</span> of interest. As seen on Fig. 2-1,
the process consists of four major steps. <br>
  <br>
  </p>
  <p style="font-family: Helvetica,Arial,sans-serif;"><img
 alt="Basic GEM IPM flow chart" src="IPM.png"
 style="width: 510px; height: 521px;"></p>
  <p style="font-family: Helvetica,Arial,sans-serif;"><br>
The first step is to obtain an initial approximation of the <span
 style="font-style: italic;">n</span> vector which is close enough to
the <span style="font-style: italic;">G</span>(<span
 style="font-style: italic;">n</span>) minimum, so that the GEM process
would succeed in finding the solution of the problem. In principle, any
previously calculated speciation vector<span style="font-style: italic;">
n</span> for this setup of thermodynamic system (even for different <span
 style="font-style: italic;">b, T, P</span>) can be used as initial
approximation in "smart initial approximation" (SIA) mode. If no
previous solution is available at all, or the available one is bad,
then the so-called "automatic initial approximation" (AIA) must
obtained by solving a linear programming (LP) sub-problem using a
modified simplex method. <br>
  </p>
  <p style="font-family: Helvetica,Arial,sans-serif;">The LP
sub-problem is constructed by truncating all the mixing terms from
chemical potential expressions for all components of phases-solutions,
which is equivalent to considering any component as a pure phase. Given
  <span style="font-style: italic;">n</span>(<span
 style="font-style: italic;">N</span>) Independent Components (usually
chemical elements and charge) in the bulk composition vector <span
 style="font-style: italic;">b</span>, the simplex solution contains at
most <span style="font-style: italic;">n</span>(<span
 style="font-style: italic;">N</span>) non-zero elements in the AIA
speciation vector <span style="font-style: italic;">n</span>(AIA).
This is also consistent with the Gibbs phase rule. <br>
  </p>
  <p style="font-family: Helvetica,Arial,sans-serif;">Usually, the
number of aqueous species is greater than <span
 style="font-style: italic;">n</span>(<span style="font-style: italic;">N</span>).
If the number of stoichiometrically possible phases exceeds n(N), such
system is called "multisystem" [Karpov et al., 1997]. Equilibria in
multisystems cannot be solved directly by LMA algorithm (see a <a
 href="#CRITIQUE-LMA">comment here</a>), but such equilibria can be
solved in one GEM run, if the initial approximation belongs to the
so-called "feasible domain". So, the second step consists in checking
whether the AIA or SIA vector <span style="font-style: italic;">n</span>
is feasible, i.e. whether the mass balance residuals for all
independent components are small enough. This is usually so in the case
of previously available SIA vector. But the AIA vector contains many
zero amounts of chemical species (dependent components) which may be
relevant aqueous species or form stable condensed or fluid phases,
although this is not a priori known. For that reason, the zero mole
amounts in the AIA initial approximation are filled out with a default
amount (1e-7 - 1e-6 mol) which then would increase or decrease upon GEM
iterations depending on the stability of the chemical species in this
chemical system. If the current amount of <span
 style="font-style: italic;">j</span>-th species <span
 style="font-style: italic;">n<sub>j</sub></span> falls below a certain
numerical threshold (ca. 1e-20 mol), it will be zeroed off. This
eliminates the <span style="font-style: italic;">j</span>-th species
from subsequent GEM iterations in order to avoid numerical troubles.
However, if the total amount of a phase falls below another threshold
(Pa_DS between 1e-9 and 1e-12 mol) then all components in this phase
will be zeroed off and the whole phase is eliminated from next GEM
iterations.<br>
  </p>
  <p style="font-family: Helvetica,Arial,sans-serif;">The fill-out
procedure in AIA bears also a danger that the mass balance is violated.
Hence, a special EFD() algorithm checks the mass balance residuals and
tries to change the largest elements of the AIA vector in such a way
that the mass balance accuracy would be at least satisfactory (i.e.
deviations less than 1e-7 mol). This is usually done in a few
iterations, and then the initial approximation vector is ready for the
main GEM algorithm. <br>
  </p>
  <p style="font-family: Helvetica,Arial,sans-serif;">The third step is
to adjust the elements of <span style="font-style: italic;"></span>speciation
vector <span style="font-style: italic;">n</span> to minimize the
total Gibbs energy of the system <span style="font-style: italic;">G</span>(<span
 style="font-style: italic;">n</span>) while keeping mass balance
deviations the same or lower as inherited from the EFD() step. This is
the core of IPM-2 algorithm - it approaches the GEM problem using the
duality (Kuhn-Tucker) theorem by introducing Lagrange multipliers <span
 style="font-style: italic;">u<sub>i</sub></span> conjugate to the
elements <span style="font-style: italic;">b<sub>i</sub></span> of the
bulk composition vector. These Lagrange multipliers form the so-called
"dual solution" of the GEM problem (the "primal solution" being the <span
 style="font-style: italic;">n</span> speciation vector). The total
Gibbs energy of the system can be calculated either as <span
 style="font-style: italic;">G</span>(<span style="font-style: italic;">n</span>)
= sum(<span style="font-style: italic;">n<sub>j</sub> v<sub>j</sub></span>)
where <span style="font-style: italic;">v<sub>j</sub></span> = <span
 style="font-style: italic;">f</span>(<span style="font-style: italic;">g</span><sup>o</sup><sub><span
 style="font-style: italic;">j</span></sub>, <span
 style="font-style: italic;">n</span>) is the primal chemical potential
of j-th dependent component., or as <span style="font-style: italic;">G</span>(<span
 style="font-style: italic;">b</span>) = sum(<span
 style="font-style: italic;">b<sub>i</sub> u<sub>i</sub></span>).
Towards equilibrium, <span style="font-style: italic;">G</span>(<span
 style="font-style: italic;">n</span>) scalar value approaches a
(global) minimum which equals the <span style="font-style: italic;">G</span>(<span
 style="font-style: italic;">b</span>) (global) maximum. Hence, the
criterion of convergence can be constructed using any normalized
function of <span style="font-style: italic;">G</span>(<span
 style="font-style: italic;">n</span>) - <span
 style="font-style: italic;">G</span>(<span style="font-style: italic;">b</span>)
which is ideally zero, but numerically must be below a small threshold
(for the quadratic Dikin's criterion, DK &lt; Pa_DK = 1e-4).&nbsp; <br>
  </p>
  <p style="font-family: Helvetica,Arial,sans-serif;">Each iteration of
IPM consists of three steps. First, a new dual solution approximation <span
 style="font-style: italic;">u</span> is found by solving with the
Cholesky decomposition method a SLE constructed from the previous
primal solution, stoichiometry matrix and weight multipliers. Next, the
vector of descent direction is found by comparing primal and dual
chemical potentials for each dependent component. Finally, a step
length multiplier is determined from a condition that no new nj value
should break the "feasible domain" of mass balance and metastability
constraints. The new approximation of the <span
 style="font-style: italic;">n</span> speciation vector is found by
incrementing non-zero elements of the old one with a product of the
respective element of the descent direction vector and the scalar step
length. Convergence is usually achieved in 1-10 iterations in the SIA
and 20 to 100 iterations in the simplex AIA case. <br>
  </p>
  <p style="font-family: Helvetica,Arial,sans-serif;">The fourth step
is called "phase selection" (implemented in PhaseSelect() function). It
consists in calculation of Karpov's phase stability criteria for each
multi-component phase present in non-zero amount, as well as for each
pure phase, either zeroed off or not. The stability criteria have been
derived from the Karpov-Kuhn-Tucker conditions of equilibrium state
that compare primal and dual estimates of chemical potential for each
component. For any stable component in a stable phase, the value of
such criterion must be close to zero.&nbsp; However, if the initial
approximation was bad, or there were errors in stoichiometry or <span
 style="font-style: italic;">g</span><sup>o</sup> value for a dependent
component, <span style="font-style: italic;"></span> the value of
Karpov's criterion may indicate that a phase present in the mass
balance is unstable and must be excluded, or vice versa - a phase
absent from the mass balance (zeroed off) is stable and must be
included. If any such phase has been detected, it is zeroed off
respectively its component amounts are filled out with small amounts,
and the whole sequence is repeated from Step two (but without the
overall fill-out step). If, after three such refinement loops, the
PhaseSelect() still finds inconsistent phases, the behavior of GEM IPM
algorithm depends on the original initial approximation. If it was SIA,
the mode is automatically switched to AIA and calculation begin "from
scratch", i.e. from solving the LP sub-problem for a generic IA. If it
was AIA, an error message is generated and the GEM solution is not
accepted. <br>
  </p>
  <p style="font-family: Helvetica,Arial,sans-serif;">The flow-chart
described above applies when all elements of the bulk composition
vector (except charge) exceed 1e-6 mol. However, if there are some
elements less than 1e-7 mol, the IPM algorithm starting with AIA may
fail with the corresponding mass balance residual which may also be of
the same order of magnitude or even higher (i.e. the mass balance error
may be from 50% to 1000%). The reason for that is the "fill-out" step
spoils the mass balance and the EFD() procedure cannot recover it
completely. In this sutiation, the IPM-2 algorithm is invoked, which in
the case of AIA first runs as the generic IPM algorithm. Even with bad
mass balance precision, this step yields a solution which lies very
close to the <span style="font-style: italic;">G</span>(<span
 style="font-style: italic;">n</span>) minimum and can be used as a
very good initial approximation where the fill-out procedure is not
needed (because all stable phases and components are already known) and
the mass balance residuals thresholds in the EFD-2() procedure can be
set at much lower levels, separately for different independent
components. This is the idea of IPM-2 refinement loops: after
convergence of GEM descent and PhaseSelect() check, an additional check
for the fullfillment of severe mass balance requirements is performed.
If there are still some bad residuals, the loop is repeated with just
obtained approximation of the <span style="font-style: italic;">n</span>
vector from the EFD-2() procedure. In most cases, up to 15 such loops
are sufficient to provide a GEM solution with 0.1% maximum mass balance
residual even for the smallest "trace" independent component present in
1e-14 mol total amount. <br>
  </p>
  <p style="font-family: Helvetica,Arial,sans-serif;">A similar
sequence of refinement loops can be applied when two or more non-ideal
solution phases are present near the critical point of their solvus. In
such a system, the difference in molar Gibbs energy of such phases
becomes tiny and up to 20 refinement GEM-IPM2 runs may be required to
obtain correct speciation. Such systems, however, are rare and in
principle cannot be solved with LMA algorithms. <br>
  </p>
  <p style="font-family: Helvetica,Arial,sans-serif;">All these
numerical paths of the iterative GEM IPM-2 algorithm are controlled
through ca. 20 thresholds and flags, values of which were empirically
found in many test and modelling calculations in various systems. These
  <a href="#NUMERICAL_CONTROLS">numerical controls</a> can be adjusted
in GEMS-PSI GUI window or in the
  <big><span style="font-family: monospace;">*ipm.dat</span></big>&nbsp;
input file of GEMIPM2K standalone program, as described in the <a
 href="gemipm2k-inp.html">companion manual</a>. <br>
  <br>
  </p>
  <p>&nbsp;</p>
  <h3><a name="KERNEL"></a>2.2. The GEM-IPM2 Kernel (GEMIPM2K) and its
Work Data
Structure IPM (Multi)<br>
  </h3>
  <p style="font-family: Helvetica,Arial,sans-serif;">The GEMIPM2K
program source code comprises a sub-set of C++ source code files used
in the <a href="http://gems.web.psi.ch">GEMS-PSI package</a>. The
difference between two programs is controlled by a compiler define
key&nbsp; <big><span style="font-family: monospace;">-DGEMIPMPLUGIN</span></big>&nbsp;
which has to be provided in the make- or project file for building any
program that uses GEMIPM2K. The global&nbsp; <big><span
 style="font-family: monospace;">#define GEMIPMPLUGIN</span></big>&nbsp;
in the source code cuts any connection to the GEM-Selektor GUI, its
data object descriptors, and data base functions. In both cases, some
numerical subroutines from <a
 href="http://math.nist.gov/tnt/download.html">NIST JAMA-C++ TNT package</a>
for solving SLE are employed. <br>
  </p>
  <p style="font-family: Helvetica,Arial,sans-serif;">Here is the list
of source code files common to both GEMS-PSI and GEMIPM2K programs:<br>
  </p>
  <table border="1" cellpadding="2" cellspacing="2" width="100%">
    <tbody>
      <tr>
        <td style="vertical-align: top;"><span
 style="font-family: Helvetica,Arial,sans-serif;">File name</span><br>
        </td>
        <td style="vertical-align: top;"><span
 style="font-family: Helvetica,Arial,sans-serif;">Comment</span><br>
        </td>
      </tr>
      <tr>
        <td style="font-family: monospace;"><big>array.h</big></td>
        <td style="vertical-align: top;">Header and templates for
manipulating data arrays <br>
        </td>
      </tr>
      <tr>
        <td style="font-family: monospace; font-weight: bold;"><a
 href="../../databr.h"><big>databr.h</big></a></td>
        <td style="vertical-align: top;">Header for the DATABR
input/output data exchange structure of GEMIPM2K<br>
        </td>
      </tr>
      <tr>
        <td style="font-family: monospace; font-weight: bold;"><a
 href="../../datach.h"><big>datach.h</big></a></td>
        <td style="vertical-align: top;">Header for the DATACH input
chemical system definition structure of GEMIPM2K</td>
      </tr>
      <tr>
        <td style="font-family: monospace;"><big>gdatastream.cpp</big></td>
        <td style="vertical-align: top;">Implementation of file I/O
streams (with account for endianness in binary data files)<br>
        </td>
      </tr>
      <tr>
        <td style="font-family: monospace;"><big>gdatastream.h</big></td>
        <td style="vertical-align: top;">Header for I/O streams for
file access <br>
        </td>
      </tr>
      <tr>
        <td style="font-family: monospace;"><big>gstring.cpp</big></td>
        <td style="vertical-align: top;">Implementation of string
manipulation functions <br>
        </td>
      </tr>
      <tr>
        <td style="font-family: monospace;"><big>gstring.h</big></td>
        <td style="vertical-align: top;">Header for the string
manipulation class <br>
        </td>
      </tr>
      <tr>
        <td style="font-family: monospace;"><big>io_arrays.cpp</big></td>
        <td style="vertical-align: top;">Implementation of file I/O of
data arrays <br>
        </td>
      </tr>
      <tr>
        <td style="font-family: monospace;"><big>io_arrays.h</big></td>
        <td style="vertical-align: top;">Header for the file I/O data
arrays functionality <br>
        </td>
      </tr>
      <tr>
        <td style="font-family: monospace;"><big>ipm_chemical.cpp</big></td>
        <td style="vertical-align: top;">Implementation of
chemistry-specific functions from TMulti class used in the GEM IPM
kernel<br>
        </td>
      </tr>
      <tr>
        <td style="font-family: monospace;"><big>ipm_chemical2.cpp</big></td>
        <td style="vertical-align: top;">Continued<br>
        </td>
      </tr>
      <tr>
        <td style="font-family: monospace;"><big>ipm_chemical3.cpp</big></td>
        <td style="vertical-align: top;">Calculation of activity
coefficients and respective corrections to chemical potentials in GEM
IPM <br>
        </td>
      </tr>
      <tr>
        <td style="font-family: monospace;"><big>ipm_main.cpp</big></td>
        <td style="vertical-align: top;">Implementation of main GEM IPM
descent algorithm <br>
        </td>
      </tr>
      <tr>
        <td style="font-family: monospace;"><big>ipm_simplex.cpp</big></td>
        <td style="vertical-align: top;">Implementation of LP
calculations of automatic initial approximation using the modified
simplex method<br>
        </td>
      </tr>
      <tr>
        <td style="font-family: monospace;"><big>jama_cholesky.h</big></td>
        <td style="vertical-align: top;">File from the NIST TNT
JAMA-C++ linear algebra numerical library<br>
        </td>
      </tr>
      <tr>
        <td style="font-family: monospace;"><big>jama_lu.h</big></td>
        <td style="vertical-align: top;">File from the NIST TNT
JAMA-C++ linear algebra numerical library</td>
      </tr>
      <tr>
        <td style="font-family: monospace; font-weight: bold;"><a
 href="../../ms_multi.h"><big>ms_multi.h</big></a></td>
        <td style="vertical-align: top;">Main header for the TMulti
class and MULTI data structure keeping data of GEM IPM-2 algorithm<br>
        </td>
      </tr>
      <tr>
        <td style="font-family: monospace;"><big>ms_multi_file.cpp</big></td>
        <td style="vertical-align: top;">Implementation of GEMIPM2K
file output (text dump file with TMulti data)<br>
        </td>
      </tr>
      <tr>
        <td style="font-family: monospace;"><big>ms_multi_format.cpp</big></td>
        <td style="vertical-align: top;">Implementation of GEMIPM2K
file I/O (text and binary *ipm files)</td>
      </tr>
      <tr>
        <td style="font-family: monospace;"><big>node.cpp</big></td>
        <td style="vertical-align: top;">Implementation of GEMIPM2K
TNode class - data exchange interface for coupled codes<br>
        </td>
      </tr>
      <tr>
        <td style="font-family: monospace; font-weight: bold;"><a
 href="../../node.h"><big>node.h</big></a></td>
        <td style="vertical-align: top;">Header for the TNode class
(used in GEMIPM2K and in GEM2MT module of GEMS-PSI)<br>
        </td>
      </tr>
      <tr>
        <td style="font-family: monospace;"><big>node_format.cpp</big></td>
        <td style="vertical-align: top;">Implementation of GEMIPM2K
file I/O (text and binary *dch and *dbr files)</td>
      </tr>
      <tr>
        <td style="font-family: monospace;"><big>nodearray.cpp</big></td>
        <td style="vertical-align: top;">Implementation of GEMIPM2K
TNodeArray class - data exchange interface for coupled codes</td>
      </tr>
      <tr>
        <td style="font-family: monospace; font-weight: bold;"><a
 href="../../nodearray.h"><big>nodearray.h</big></a></td>
        <td style="vertical-align: top;">Header for the TNodeArray
class (used in GEMIPM2K and in GEM2MT module of GEMS-PSI)</td>
      </tr>
      <tr>
        <td style="font-family: monospace;"><big>num_methods.cpp</big></td>
        <td style="vertical-align: top;">Implementation of the internal
numerical&nbsp; solvers used in GEM IPM module <br>
        </td>
      </tr>
      <tr>
        <td style="font-family: monospace;"><big>num_methods.h</big></td>
        <td style="vertical-align: top;">Headers for internal numerical
functions used in GEM IPM module for solving SLE and interpolation<br>
        </td>
      </tr>
      <tr>
        <td style="font-family: monospace;"><big>s_fgl.cpp</big></td>
        <td style="vertical-align: top;">Implementation of buil-in
non-ideal fluid and some solid solution models<br>
        </td>
      </tr>
      <tr>
        <td style="font-family: monospace;"><big>s_fgl.h</big></td>
        <td style="vertical-align: top;">Headers for built-in non-ideal
fluid and solution models<br>
        </td>
      </tr>
      <tr>
        <td style="font-family: monospace;"><big>s_fgl2.cpp</big></td>
        <td style="vertical-align: top;">Implementation of buil-in
non-ideal fluid and some solid solution models</td>
      </tr>
      <tr>
        <td style="font-family: monospace;"><big>tnt.h</big></td>
        <td style="vertical-align: top;">File from the NIST TNT linear
algebra numerical library</td>
      </tr>
      <tr>
        <td style="font-family: monospace;"><big>tnt_array1d.h</big></td>
        <td style="vertical-align: top;">File from the NIST TNT linear
algebra numerical library</td>
      </tr>
      <tr>
        <td style="font-family: monospace;"><big>tnt_array2d.h</big></td>
        <td style="vertical-align: top;">File from the NIST TNT linear
algebra numerical library</td>
      </tr>
      <tr>
        <td style="font-family: monospace;"><big>tnt_i_refvec.h</big></td>
        <td style="vertical-align: top;">File from the NIST TNT linear
algebra numerical library</td>
      </tr>
      <tr>
        <td style="font-family: monospace;"><big>v_user.h</big></td>
        <td style="vertical-align: top;">Header containing declarations
of platform-specific utility functions and classes<br>
        </td>
      </tr>
      <tr>
        <td style="font-family: monospace;"><big>verror.h</big></td>
        <td style="vertical-align: top;">Declarations for error
exceptions handling: classes TError and TFatalError<br>
        </td>
      </tr>
    </tbody>
  </table>
  <p style="font-family: Helvetica,Arial,sans-serif;"></p>
  <p style="font-family: Helvetica,Arial,sans-serif;"><br>
Files necessary for calling GEMIPM2K from coupled codes are shown in
boldface. <br>
  </p>
  <p style="font-family: Helvetica,Arial,sans-serif;">Two header files
from GEMIPM2K directory listed below have the same names as in the
GEMS-PSI source code, but different contents. <br>
  </p>
  <table border="1" cellpadding="2" cellspacing="2" width="100%">
    <tbody>
      <tr>
        <td style="font-family: monospace;"><a href="../../m_const.h"><big>m_const.h</big></a></td>
        <td style="vertical-align: top;">Codes and parameters for
components and phases used in GEM IPM-2 work structure (standalone
version)<br>
        </td>
      </tr>
      <tr>
        <td style="font-family: monospace;"><a href="../../m_param.h"><big>m_param.h</big></a></td>
        <td style="vertical-align: top;">Basic codes and numerical
settings used in GEM IPM-2 operation (standalone version)<br>
        </td>
      </tr>
    </tbody>
  </table>
  <p style="font-family: Helvetica,Arial,sans-serif;"><br>
The files below: <br>
  </p>
  <table border="1" cellpadding="2" cellspacing="2" width="100%">
    <tbody>
      <tr>
        <td style="font-family: monospace;"><a href="../../ms_param.cpp"><big>ms_param.cpp
        <br>
        </big></a></td>
        <td style="vertical-align: top;">Default values of constants
and numerical settings of GEM IPM-2 algorithm; implementations of
methods that load data into/from&nbsp; MULTI structure and execute a
single GEM IPM calculation<br>
        </td>
      </tr>
      <tr>
        <td style="font-family: monospace;"><a href="../../main.cpp"><big>main.cpp</big></a></td>
        <td style="vertical-align: top;">Example of using GEMIPM2K for
batch calculations of chemical equilibria<br>
        </td>
      </tr>
    </tbody>
  </table>
  <p style="font-family: Helvetica,Arial,sans-serif;">&nbsp;are
provided only in the GEMIPM2K code. The file&nbsp; <big><span
 style="font-family: monospace;">main.cpp</span></big>&nbsp; is needed
for compiling an example of usage of GEMIPM2K. This file can be changed
according to your tasks. <br>
  </p>
  <p style="font-family: Helvetica,Arial,sans-serif;">There are two
alternative make files, provided for different arcitectures in the
./platforms subdirectory. <br>
  </p>
  <table border="1" cellpadding="2" cellspacing="2" width="100%">
    <tbody>
      <tr>
        <td style="font-family: monospace;"><big>Makefile</big></td>
        <td style="vertical-align: top;">make script for building test
example with file I/O as a standalone executable file <br>
        </td>
      </tr>
      <tr>
        <td style="font-family: monospace;"><big>Makefile.lib</big></td>
        <td style="vertical-align: top;">make script for creating a
static library for subsequent linking with other parts of the coupled
FMT-GEM code<br>
        </td>
      </tr>
    </tbody>
  </table>
  <p><big><span style="font-family: monospace;">Makefile</span></big><span
 style="font-family: Helvetica,Arial,sans-serif;"> is used for building
a static executable file </span><big><span
 style="font-family: monospace;">gemcalc(.exe)</span></big><span
 style="font-family: Helvetica,Arial,sans-serif;"> for the test
example. <br>
  </span><big><span style="font-family: monospace;">Makefile.lib</span></big><span
 style="font-family: Helvetica,Arial,sans-serif;"> can be used for
building a static library&nbsp; </span><big><span
 style="font-family: monospace;">gemipm2k.a</span></big><span
 style="font-family: Helvetica,Arial,sans-serif;">&nbsp; (or </span><big><span
 style="font-family: monospace;">gemipm2k.lib</span></big><span
 style="font-family: Helvetica,Arial,sans-serif;">) which can be linked
to the mass-transport&nbsp; part to produce a coupled code later on.<br>
  </span></p>
  <p><span style="font-family: Helvetica,Arial,sans-serif;">The GEM
IPM-2 algorithm is implemented as a set of C++ functions belonging to
the TMulti class that all use data and lists provided in a single
instance of the&nbsp; MULTI data structure also inserted into the
TMulti class. Before any GEM calculation, all data arrays must be
allocated according to current number of components and phases, and all
input data must be correctly filled into these arrays. <br>
  </span></p>
  <p><span style="font-family: Helvetica,Arial,sans-serif;">In the
GEMS-PSI GUI environment, this is done automatically before any GEM
calculation is started. The data of the "internal" GEM problem are
compressed into MULTI data structure by collecting the items from the
project system lists and arrays, as well as from the thermodynamic data
base. In the project system lists, many independent components,
dependent components, and phases may be switched off by the user. Only
the names and data for components and phases that are switched on are
copied into the MULTI structure. If necessary, the scripts for
calculating activity coefficients of components of non-ideal solution
phases are also compressed, together with any needed coefficients for
non-ideal interaction parameters or surface complexation models picked
up from the Phase database records. This makes the GEMS GUI setup of
thermodynamic models very flexible, though rendering its software
implementation rather complicated. <br>
  </span></p>
  <p><span style="font-family: Helvetica,Arial,sans-serif;">This route
cannot be followed in the standalone GEMIPM2K program and any programs
using it. The purpose of GEMIPM2K is to keep the code implementation
and handling of I/O data as simple as possible. This is the
prerequisite for compiling the cupled FMT-GEM program on any computer
architecture, up to parallel HPC clusters. Consequently, the GEMIPM2K
program has no GUI, no direct access to thermodynamic data base, and it
has no script interpreter included. It uses only data for a
"compressed" GEM problem thoroughly contained in the MULTI structure
(i.e. no components or phases that were switched off from the lists are
allowed). Because of that, some restrictions apply in GEMIPM2K relative
to GEMS-PSI code: <br>
  </span></p>
  <h4><span style="font-family: Helvetica,Arial,sans-serif;">&nbsp;DIfferences
in functionality between GEMIPM2K program and the full GEMS-PSI code<br>
  </span></h4>
  <table style="text-align: left; width: 100%;" border="1"
 cellpadding="2" cellspacing="2">
    <tbody>
      <tr>
        <td
 style="vertical-align: top; font-family: Helvetica,Arial,sans-serif;">Function<br>
        </td>
        <td
 style="vertical-align: top; font-family: Helvetica,Arial,sans-serif;">GEMIPM2K<br>
        </td>
        <td
 style="vertical-align: top; font-family: Helvetica,Arial,sans-serif;">GEMS-PSI<br>
        </td>
      </tr>
      <tr>
        <td style="vertical-align: top;">Phase- and Process math scripts<br>
        </td>
        <td style="vertical-align: top;">Not possible<br>
        </td>
        <td style="vertical-align: top;">Used<br>
        </td>
      </tr>
      <tr>
        <td style="vertical-align: top;">Built-in functions for
activity coefficients<br>
        </td>
        <td style="vertical-align: top;">Used<br>
        </td>
        <td style="vertical-align: top;">Used<br>
        </td>
      </tr>
      <tr>
        <td style="vertical-align: top;">T-P corrections for input
thermodynamic data<br>
        </td>
        <td style="vertical-align: top;">Interpolation using a lookup
grid array <br>
        </td>
        <td style="vertical-align: top;">Direct access to thermodynamic
data base<br>
        </td>
      </tr>
      <tr>
        <td style="vertical-align: top;">Access to input, output and
work data<br>
        </td>
        <td style="vertical-align: top;">Batch mode only (I/O files or
in RAM)<br>
        </td>
        <td style="vertical-align: top;">Direct GUI access, incl.
stepwise mode<br>
        </td>
      </tr>
      <tr>
        <td style="vertical-align: top;">Runtime help and tooltips <br>
        </td>
        <td style="vertical-align: top;">Not available<br>
        </td>
        <td style="vertical-align: top;">Available (HTML help)<br>
        </td>
      </tr>
    </tbody>
  </table>
  <p><span style="font-family: Helvetica,Arial,sans-serif;"><br>
In principle,&nbsp; all the input data required for GEM IPM-2
calculation can be provided in a human-made ASCII file. However,
producing such file without a software fron-end accessing the
thermodynamic data base would be a difficult and error-prone
process.&nbsp; <br>
  </span></p>
  <p><span style="font-family: Helvetica,Arial,sans-serif;">Moreover,
RMT problems are usually represented by many nodes; reactive subsystems
in all these nodes can share the same chemical system definition (CSD)
and would usually differ only in bulk chemical composition (,
temperature and pressure). Hence, it would make no sense to use the
MULTI data structure directly for data exchange with the mass-transport
part. Often, not all independent and dependent components must take
place in exchange with the MT part - only those components that are
somehow transported from node to node. <br>
  </span></p>
  <p><span style="font-family: Helvetica,Arial,sans-serif;">For these
reasons, the whole content of the MULTI and BASE_PARAM data structures
required for a GEM IPM-2 calculation has been subdivided into three
main parts, or data sub-sets (covered with the respective I/O files): <br>
  </span></p>
  <p><span style="font-family: Helvetica,Arial,sans-serif;"></span></p>
  <table style="text-align: left; width: 100%;" border="1"
 cellpadding="2" cellspacing="2">
    <tbody>
      <tr>
        <td
 style="vertical-align: top; font-family: Helvetica,Arial,sans-serif;">&nbsp;Identifier
of data subset<br>
        </td>
        <td
 style="vertical-align: top; font-family: Helvetica,Arial,sans-serif;">&nbsp;Data
structure<br>
        </td>
        <td style="vertical-align: top;">&nbsp;<span
 style="font-family: Helvetica,Arial,sans-serif;">Visibility</span> <br>
        </td>
        <td
 style="vertical-align: top; font-family: Helvetica,Arial,sans-serif;"><a
 href="#INPUT_FILES">&nbsp;I/O file</a><br>
        </td>
        <td
 style="vertical-align: top; font-family: Helvetica,Arial,sans-serif;">&nbsp;Comment<br>
        </td>
      </tr>
      <tr>
        <td style="vertical-align: top;">DCH<br>
        </td>
        <td style="vertical-align: top;"><a href="../../datach.h"><big><span
 style="font-family: monospace;">DATACH</span></big></a><br>
        </td>
        <td style="vertical-align: top;">GEM and MT parts<br>
        </td>
        <td style="vertical-align: top;">*dch.dat&nbsp; <br>
        </td>
        <td style="vertical-align: top;">Input definition of the
chemical system (compressed) with selection of components and phases to
be exchanged with the mass-transport part common to all nodes of the
RMT problem<br>
        </td>
      </tr>
      <tr>
        <td style="vertical-align: top;">DBR<br>
        </td>
        <td style="vertical-align: top;"><a href="../../databr.h"><big><span
 style="font-family: monospace;">DATABR</span></big></a><br>
        </td>
        <td style="vertical-align: top;">GEM and MT parts<br>
        </td>
        <td style="vertical-align: top;">*dbr.dat&nbsp; <br>
        </td>
        <td style="vertical-align: top;">Data bridge for node-specific
chemical input and output properties (bulk composition, speciation,
temperature, pressure, optional kinetic constraints)<br>
        </td>
      </tr>
      <tr>
        <td style="vertical-align: top;">IPM<br>
        </td>
        <td style="vertical-align: top;"><big><span
 style="font-family: monospace;"><a href="../../ms_multi.h">MULTI</a>, <a
 href="../../m_param.h">BASE_PARAM</a></span></big><br>
        </td>
        <td style="vertical-align: top;">GEM part only<br>
        </td>
        <td style="vertical-align: top;">*ipm.dat&nbsp; <br>
        </td>
        <td style="vertical-align: top;">Input information not relevant
for the MT part, but needed for GEM IPM-2 calculations (numerical
settings, parameters of non-ideal mixing models, adsorption models
etc.) <br>
        </td>
      </tr>
    </tbody>
  </table>
  <p><span style="font-family: Helvetica,Arial,sans-serif;">DCH and DBR
files are automatically (un)packed to/from the MULTI memory structure
inside of the TNode class. <br>
  </span></p>
  <p><span style="font-family: Helvetica,Arial,sans-serif;">The
advantage of having three kinds of input files instead of one is that
in a typical RMT problem with hudreds of thousands of nodes, only one
relatively large DCH and one IPM file is needed, while node-specific
data are provided in many small and compact input-output DBR files
without redundant information. As a consequence,&nbsp; higher
performance and flexibility of the coupled code can be achieved. <br>
  </span></p>
  <p><span style="font-family: Helvetica,Arial,sans-serif;">In the
current implementation of GEMIPM2K, two file I/O modes are possible:
binary stream and text stream. Binary stream DCH, DBR and IPM files are
simply images of the respective memory data structures; they may be
non-transferable between different computer architectures. The text
stream files are transferable; they have a human-readable format with
tags (keywords) followed with the data; comment lines are possible
anywhere. For most data items, the input order is free, or they can be
skipped if the program can substitute default values.&nbsp; Only&nbsp;
dimenions necessary for internal data allocation must be present at the
beginning of DCH and IPM files. More about the file structure of
GEMIPM2K is provided in <a href="#INPUT_FILES">section 5 of this manual</a>,
as well as in the <a href="gemipm2k-inp.html">companion manual</a>.<br>
  </span></p>
  <p><span style="font-family: Helvetica,Arial,sans-serif;">In order to
facilitate preparation of GEMIPM2K input files, the GEMS-PSI code has
two ways of generating them automatically.&nbsp; One way is to set up
the chemical system in "Single thermodynamic system" dialog, calculate
equilibrium, and save it into SysEq record (see <a
 href="http://gems.web.psi.ch/screenshots/sshgal01.html">Screenshot
tutorial</a> for details). To produce the GEMIPM2 input files, follow
the <a href="#PRODUCE_FILES_S">instructions here</a>. From the same
GEMS dialog, it is even possible to upload a set of GEMIPM2K files
after GEMIPM2K or coupled code calculations (you must be in the same
modelling project system from which the initial GEMIPM2K files were
generated).&nbsp; In this way, you can conveniently explore results of
GEMIPM2K run for a single system, e.g., after changing manually some
input data in DBR or IPM file. <br>
  </span></p>
  <p><span style="font-family: Helvetica,Arial,sans-serif;">Another way
to create a set of GEMIPM2K input file with multiple DBR files (for
multiple nodes) is to set up a GEM2MT module record of "S" type (see
documentation to GEM2MT, under construction). Re-calculation of such
record results in a collection of DCH, IPM and DBR files sufficient to
start a coupled modelling session. </span><br>
  <br style="font-family: Helvetica,Arial,sans-serif;">
  <br>
  </p>
  <h3><a name="DATACH"></a>2.3. <font
 style="font-family: times new roman,times,serif;"
 face="Helvetica, Arial, sans-serif">The DATACH Structure for Chemical
System Definition (CSD)&nbsp;</font> </h3>
  <p style="font-family: Helvetica,Arial,sans-serif;">The <a
 href="../../datach.h"><big><span style="font-family: monospace;">DATACH</span></big></a>&nbsp;
structure (mirrored in a DCH input file) contains an input definition
of the chemical system visible to both GEMIPM2K and mass-transport
parts of a coupled code. The respective dimensions, lists of components
and phases etc. will be automatically copied into the MULTI work data
structure of GEM IPM algorithm upon initialization of a&nbsp; <big><span
 style="font-family: monospace;"><a href="../../node.h">TNode</a> </span></big>class
instance which consists in reading of DCH, IPM and at least one DBR
files. <br>
  </p>
  <p style="font-family: Helvetica,Arial,sans-serif;">The CSD part of
DATACH structure includes the following data: <br>
  </p>
  <table border="1" cellpadding="2" cellspacing="2" width="100%">
    <tbody>
      <tr>
        <td style="font-family: Helvetica,Arial,sans-serif;">Type</td>
        <td style="font-family: Helvetica,Arial,sans-serif;"> ID in
DATACH</td>
        <td style="font-family: Helvetica,Arial,sans-serif;"> ID in
MULTI</td>
        <td style="font-family: Helvetica,Arial,sans-serif;"> Label in
DCH file</td>
        <td style="font-family: Helvetica,Arial,sans-serif;"> DOD label
in GEMS</td>
        <td style="font-family: Helvetica,Arial,sans-serif;"> Comment</td>
      </tr>
      <tr>
        <td><span style="font-family: monospace;">short</span></td>
        <td style="font-family: monospace;"><big> nIC</big></td>
        <td> <br>
        </td>
        <td> <br>
        </td>
        <td> <br>
        </td>
        <td> // Total number of IC (independent components) <br>
        </td>
      </tr>
      <tr>
        <td><span style="font-family: monospace;"> </span><span
 style="font-family: monospace;">short</span></td>
        <td style="font-family: monospace;"><big> nDC</big></td>
        <td> <br>
        </td>
        <td> <br>
        </td>
        <td> <br>
        </td>
        <td> // Total number of DC (chemical species) <br>
        </td>
      </tr>
      <tr>
        <td><span style="font-family: monospace;"> </span><span
 style="font-family: monospace;">short</span></td>
        <td style="font-family: monospace;"><big> nPH</big></td>
        <td> <br>
        </td>
        <td> <br>
        </td>
        <td> <br>
        </td>
        <td> // Total number of phases included into the GEM IPM problem</td>
      </tr>
      <tr>
        <td><span style="font-family: monospace;"> </span><span
 style="font-family: monospace;">short</span></td>
        <td style="font-family: monospace;"><big> nPS</big></td>
        <td> <br>
        </td>
        <td> <br>
        </td>
        <td> <br>
        </td>
        <td> // Number of multicomponent phases nPS &lt;= nPH</td>
      </tr>
      <tr>
        <td><span style="font-family: monospace;"> </span><span
 style="font-family: monospace;">short</span></td>
        <td style="font-family: monospace;"><big> nDCs</big></td>
        <td> <br>
        </td>
        <td> <br>
        </td>
        <td> <br>
        </td>
        <td> // Total Number of DC in phases-solutions</td>
      </tr>
      <tr>
        <td><span style="font-family: monospace;">short</span><span
 style="font-family: monospace;">[]</span></td>
        <td style="font-family: monospace;"><big> nDCinPH</big></td>
        <td> <br>
        </td>
        <td> <br>
        </td>
        <td> <br>
        </td>
        <td> // number of DC included into each phase [nPH] </td>
      </tr>
      <tr>
        <td><span style="font-family: monospace;">float[]</span></td>
        <td style="font-family: monospace;"><big> A</big></td>
        <td> <br>
        </td>
        <td> <br>
        </td>
        <td> <br>
        </td>
        <td> // Stoichiometry matrix A containing elemental
stoichiometries of Dependent Components [nIC][nDC] elements</td>
      </tr>
      <tr>
        <td><span style="font-family: monospace;">float</span><span
 style="font-family: monospace;">[]</span></td>
        <td style="font-family: monospace;"><big> ICmm</big></td>
        <td> <br>
        </td>
        <td> <br>
        </td>
        <td> <br>
        </td>
        <td> // IC atomic (molar) mass g/mol [nIC] elements</td>
      </tr>
      <tr>
        <td><span style="font-family: monospace;">float</span><span
 style="font-family: monospace;">[]</span></td>
        <td style="font-family: monospace;"><big> DCmm</big></td>
        <td> <br>
        </td>
        <td> <br>
        </td>
        <td> <br>
        </td>
        <td> // DC molar mass g/mol [nDC] elements</td>
      </tr>
      <tr>
        <td><span style="font-family: monospace;">char*[]</span></td>
        <td style="font-family: monospace;"><big> ICNL</big></td>
        <td> <br>
        </td>
        <td> <br>
        </td>
        <td> <br>
        </td>
        <td> // List of IC names in the system [nIC] elements of MaxICN
length</td>
      </tr>
      <tr>
        <td><span style="font-family: monospace;">char*[]</span></td>
        <td style="font-family: monospace;"><big> DCNL</big></td>
        <td> <br>
        </td>
        <td> <br>
        </td>
        <td> <br>
        </td>
        <td> // List of DC names in the system [nDC] elements of MaxDCN
length</td>
      </tr>
      <tr>
        <td><span style="font-family: monospace;">char*[]</span></td>
        <td style="font-family: monospace;"><big> PHNL</big></td>
        <td> <br>
        </td>
        <td> <br>
        </td>
        <td> <br>
        </td>
        <td> // List of phase names in the system [nPH] elements of
MaxPHN length</td>
      </tr>
      <tr>
        <td><span style="font-family: monospace;">char[]</span></td>
        <td style="font-family: monospace;"><big> ccIC</big></td>
        <td> <br>
        </td>
        <td> <br>
        </td>
        <td> <br>
        </td>
        <td> // Class codes of IC see enum ICL_CLASSES ([nIC] elements)</td>
      </tr>
      <tr>
        <td><span style="font-family: monospace;">char[]</span></td>
        <td style="font-family: monospace;"><big> ccDC</big></td>
        <td> <br>
        </td>
        <td> <br>
        </td>
        <td> <br>
        </td>
        <td> // Class codes of DC see enum DCL_CLASSES ([nDC] elements)</td>
      </tr>
      <tr>
        <td><span style="font-family: monospace;">char[]</span></td>
        <td style="font-family: monospace;"><big> ccPH</big></td>
        <td> <br>
        </td>
        <td> <br>
        </td>
        <td> <br>
        </td>
        <td> // Class codes of phases see enum PHL_CLASSES ([nPH]
elements)</td>
      </tr>
    </tbody>
  </table>
  <p style="font-family: Helvetica,Arial,sans-serif;"><br>
  <br>
  </p>
  <p style="font-family: Helvetica,Arial,sans-serif;">Because direct
access to GEMS thermodynamic data base is not possible and functions
for T,P corrections of thermodynamic data&nbsp; are not available in
GEMIPM2K, the retrieval of thermodynamic data for dependent components
is implemented through the interpolation from look-up arrays provided
in the DATACH structure and file. This part includes the following
data: <br>
  </p>
  <table border="1" cellpadding="2" cellspacing="2" width="100%">
    <tbody>
      <tr>
        <td style="font-family: Helvetica,Arial,sans-serif;">Type</td>
        <td style="font-family: Helvetica,Arial,sans-serif;"> ID</td>
        <td style="font-family: Helvetica,Arial,sans-serif;"> length</td>
        <td style="font-family: Helvetica,Arial,sans-serif;"> comment</td>
        <td style="vertical-align: top;">Label in DCH file<br>
        </td>
      </tr>
      <tr>
        <td>short</td>
        <td style="font-family: monospace;"><big> nTp</big></td>
        <td> 1<br>
        </td>
        <td> // Number of temperature points in grid arrays for the
interpolation of thermodynamic data</td>
        <td style="vertical-align: top;"><br>
        </td>
      </tr>
      <tr>
        <td>short</td>
        <td style="font-family: monospace;"><big> nPp</big></td>
        <td> 1<br>
        </td>
        <td> // Number of pressure points in grid arrays for the
interpolation of thermodynamic data</td>
        <td style="vertical-align: top;"><br>
        </td>
      </tr>
      <tr>
        <td>short</td>
        <td style="font-family: monospace;"><big> iGrd</big></td>
        <td> 1<br>
        </td>
        <td> // flag for grid array setup: 0 - only V0 and G0; 1
- plus H0; 2 - plus S0; 3 - plus Cp0; 4 - plus A0 (Helmholtz); -1 - V0
G0 and DD (diffusion coefficients in aq reserved)</td>
        <td style="vertical-align: top;"><br>
        </td>
      </tr>
      <tr>
        <td>float[]</td>
        <td style="font-family: monospace;"><big> TCval</big></td>
        <td> nTp</td>
        <td> // discrete values of Temperature (C) [nTp]
elements that correspond to grid arrays for the interpolation of
thermodynamic data</td>
        <td style="vertical-align: top;"><br>
        </td>
      </tr>
      <tr>
        <td>float[]</td>
        <td style="font-family: monospace;"><big> Pval</big></td>
        <td> nPp</td>
        <td> // discrete values of Pressure (bar) [nPp] elements
that correspond to grid arrays for the interpolation of thermodynamic
data</td>
        <td style="vertical-align: top;"><br>
        </td>
      </tr>
      <tr>
        <td>double</td>
        <td style="font-family: monospace;"><big> Ttol</big></td>
        <td> 1<br>
        </td>
        <td> // Temperature tolerance (K) for interpolation of
thermodynamic data</td>
        <td style="vertical-align: top;"><br>
        </td>
      </tr>
      <tr>
        <td>double</td>
        <td style="font-family: monospace;"><big> Ptol</big></td>
        <td> 1<br>
        </td>
        <td> // Pressure tolerance (bar) for interpolation of
thermodynamic data</td>
        <td style="vertical-align: top;"><br>
        </td>
      </tr>
    </tbody>
  </table>
  <p style="font-family: Helvetica,Arial,sans-serif;"><br>
Lookup grid arrays of thermodynamic data Require a Lagrange
interpolation subroutine to extract data for a given P,T point (new
interpolation is done when P or T differs from the previous P,T by more
than Ptol, Ttol). The actual allocation of lookup arrays depends on the
control code in the iGrd field. <br>
  </p>
  <table border="1" cellpadding="2" cellspacing="2" width="100%">
    <tbody>
      <tr>
        <td style="font-family: Helvetica,Arial,sans-serif;">Type</td>
        <td style="font-family: Helvetica,Arial,sans-serif;"> ID</td>
        <td style="font-family: Helvetica,Arial,sans-serif;"> length</td>
        <td style="font-family: Helvetica,Arial,sans-serif;"> comment</td>
        <td style="vertical-align: top;">Label in DCH file<br>
        </td>
      </tr>
      <tr>
        <td>double[]<br>
        </td>
        <td style="font-family: monospace;"><big> roW</big></td>
        <td> [nPp][nTp] </td>
        <td> // density of water-solvent g/cm3 [ nPp][nTp] elements</td>
        <td style="vertical-align: top;"><br>
        </td>
      </tr>
      <tr>
        <td>double[]<br>
        </td>
        <td style="font-family: monospace;"><big> epsW</big></td>
        <td> [nPp][nTp]</td>
        <td> // dielectric constant of water-solvent [nPp][nTp] elements</td>
        <td style="vertical-align: top;"><br>
        </td>
      </tr>
      <tr>
        <td>double[]<br>
        </td>
        <td style="font-family: monospace;"><big> G0</big></td>
        <td> [nDC][nPp][nTp] </td>
        <td> // G0 standard molar Gibbs energy of DC J/mol
[nDC][nPp][nTp] elements</td>
        <td style="vertical-align: top;"><br>
        </td>
      </tr>
      <tr>
        <td>double[]<br>
        </td>
        <td style="font-family: monospace;"><big> V0</big></td>
        <td> [nDC][nPp][nTp]</td>
        <td> // V0 standard molar volume of DC J/bar [nDC][nPp][nTp]
elements</td>
        <td style="vertical-align: top;"><br>
        </td>
      </tr>
      <tr>
        <td>double[]<br>
        </td>
        <td style="font-family: monospace;"><big> S0</big></td>
        <td> [nDC][nPp][nTp]</td>
        <td> // S0 standard molar entropy of DC J/K/mol [nDC][nPp][nTp]
elements</td>
        <td style="vertical-align: top;"><br>
        </td>
      </tr>
      <tr>
        <td>double[]<br>
        </td>
        <td style="font-family: monospace;"><big> H0</big></td>
        <td> [nDC][nPp][nTp]</td>
        <td> // H0 standard molar enthalpy of DC J/mol reserved
[nDC][nPp][nTp] elements</td>
        <td style="vertical-align: top;"><br>
        </td>
      </tr>
      <tr>
        <td>double[]<br>
        </td>
        <td style="font-family: monospace;"><big> Cp0</big></td>
        <td> [nDC][nPp][nTp] </td>
        <td> // Cp0 molar heat capacity of DC J/K/mol [nDC][nPp][nTp]
elements</td>
        <td style="vertical-align: top;"><br>
        </td>
      </tr>
      <tr>
        <td>double[]<br>
        </td>
        <td style="font-family: monospace;"><big> DD</big></td>
        <td> [nDC][nPp][nTp]</td>
        <td> // Diffusition coefficients [nDC][nPp][nTp] elements for
now constant (reserved)</td>
        <td style="vertical-align: top;"><br>
        </td>
      </tr>
    </tbody>
  </table>
  <p style="font-family: Helvetica,Arial,sans-serif;"><br>
Third part of the DATACH structure (and file) defines the selection of
components and phases to be exchanged with the mass-transport part via
DATABR structure instances for nodes or DBR files. This includes the
following data items: Connection between any node and DATACH occurs
through the xIC, xPH and xDC index lists (see below) Indices connecting
the lists used in nodes (DATABR structure), see&nbsp; databr.h, with
the lists in this (DATACH) structure<br>
  </p>
  <table border="1" cellpadding="2" cellspacing="2" width="100%">
    <tbody>
      <tr>
        <td>Type</td>
        <td> ID</td>
        <td> length</td>
        <td> comment</td>
        <td style="vertical-align: top;">Label in DCH file<br>
        </td>
      </tr>
      <tr>
        <td>short</td>
        <td style="font-family: monospace;"><big> nICb</big></td>
        <td> 1<br>
        </td>
        <td> // number of IC (stoichiometry units) (&lt;= nIC) used in
nodes</td>
        <td style="vertical-align: top;"><br>
        </td>
      </tr>
      <tr>
        <td>short</td>
        <td style="font-family: monospace;"><big> nDCb</big></td>
        <td> 1<br>
        </td>
        <td> // number of DC (chemical species) &lt;= nDC) used in nodes</td>
        <td style="vertical-align: top;"><br>
        </td>
      </tr>
      <tr>
        <td>short</td>
        <td style="font-family: monospace;"><big> nPHb</big></td>
        <td> 1<br>
        </td>
        <td> // number of Phases (&lt;= nPH) used in nodes</td>
        <td style="vertical-align: top;"><br>
        </td>
      </tr>
      <tr>
        <td>short</td>
        <td style="font-family: monospace;"><big> nPSb</big></td>
        <td> 1<br>
        </td>
        <td> // number of Phases-solutions (&lt;= nPS) used in nodes</td>
        <td style="vertical-align: top;"><br>
        </td>
      </tr>
      <tr>
        <td>short</td>
        <td style="font-family: monospace;"><big> nAalp</big></td>
        <td> 1<br>
        </td>
        <td> // Flag for considering surface areas of phases</td>
        <td style="vertical-align: top;"><br>
        </td>
      </tr>
      <tr>
        <td>short[]</td>
        <td style="font-family: monospace;"><big> xIC</big></td>
        <td> [nICb]</td>
        <td> // IC name indices in DATABR IC vectors [nICb] elements</td>
        <td style="vertical-align: top;"><br>
        </td>
      </tr>
      <tr>
        <td>short[]</td>
        <td style="font-family: monospace;"><big> xDC</big></td>
        <td> [nDCb]</td>
        <td> // DC name indices in DATABR DC vectors [nDCb] elements</td>
        <td style="vertical-align: top;"><br>
        </td>
      </tr>
      <tr>
        <td>short[]</td>
        <td style="font-family: monospace;"><big> xPH</big></td>
        <td> [nPHb]</td>
        <td> // PH name indices in DATABR Phase vectors [nPHb] elements</td>
        <td style="vertical-align: top;"><br>
        </td>
      </tr>
    </tbody>
  </table>
  <p style="font-family: Helvetica,Arial,sans-serif;">see definitions
of the ICNL, DCNL and PHNL lists<br>
  </p>
  <br>
  <br>
  <p> </p>
  <h3><a name="DATABR"></a>2.4. <font
 face="Helvetica, Arial, sans-serif"><span
 style="font-family: times new roman,times,serif;">The DATABR Structure
for the Node Data Bridge Composition and Speciation data</span> </font>
  </h3>
  <p><span style="font-family: Helvetica,Arial,sans-serif;">This data
structure relies on dimensions provided in the DATACH structure. Hence,
the DCH file must always be read before DBR file(s) in order to
initialize the MULTI and DATABR structures and perform dynamic memory
allocation. </span><br>
  </p>
  <p><span style="font-family: monospace;">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Usage of this variable (DB - data bridge)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; MT-DB DB-GEM GEM-DB DB-MT</span><br
 style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp; double</span><br
 style="font-family: monospace;">
  <span style="font-family: monospace;">// Chemical scalar variables</span><br
 style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
TC,&nbsp;&nbsp;&nbsp;&nbsp; // Temperature T,
C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; +&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&nbsp;&nbsp;&nbsp;&nbsp; -</span><br
 style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp; P,
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; // Pressure P,
bar&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
-&nbsp;&nbsp;&nbsp;&nbsp; -</span><br style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
Vs,&nbsp;&nbsp;&nbsp;&nbsp; // Volume V of reactive subsystem,
cm3&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
-&nbsp;&nbsp;&nbsp;&nbsp; (+) &nbsp;&nbsp;&nbsp;
+&nbsp;&nbsp;&nbsp;&nbsp; +</span><br style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
Vi,&nbsp;&nbsp;&nbsp;&nbsp; // Volume of inert subsystem,
cm3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; +&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&nbsp;&nbsp;&nbsp;&nbsp; +</span><br
 style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
Ms,&nbsp;&nbsp;&nbsp;&nbsp; // Mass of reactive subsystem,&nbsp;
g&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; +&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&nbsp;&nbsp;&nbsp;&nbsp; -</span><br
 style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
Mi,&nbsp;&nbsp;&nbsp;&nbsp; // Mass of inert subsystem,
g&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; +&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&nbsp;&nbsp;&nbsp;&nbsp; +</span><br
 style="font-family: monospace;">
  <br style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
Gs,&nbsp;&nbsp;&nbsp;&nbsp; // Gibbs energy of reactive subsystem,
J&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; -&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +&nbsp;&nbsp;&nbsp;&nbsp; +</span><br
 style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp; Hs,
&nbsp;&nbsp;&nbsp; // Enthalpy of reactive subsystem,
J&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp;
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+&nbsp;&nbsp;&nbsp;&nbsp; +</span><br style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
Hi,&nbsp;&nbsp;&nbsp;&nbsp; // Enthalpy of inert subsystem,
J&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp;
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
-&nbsp;&nbsp;&nbsp;&nbsp; +</span><br style="font-family: monospace;">
  <br style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
IC,&nbsp;&nbsp;&nbsp;&nbsp; // Effective aqueous ionic strength, molal
&nbsp; &nbsp; -&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +&nbsp;&nbsp;&nbsp;&nbsp; +</span><br
 style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
pH,&nbsp;&nbsp;&nbsp;&nbsp; // pH of aqueous solution (-log10
molal)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+&nbsp;&nbsp;&nbsp;&nbsp; +</span><br style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
pe,&nbsp;&nbsp;&nbsp;&nbsp; // pe of aqueous solution (-log10
molal)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+&nbsp;&nbsp;&nbsp;&nbsp; +</span><br style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
Eh,&nbsp;&nbsp;&nbsp;&nbsp; // Eh of aqueous solution,
V&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+&nbsp;&nbsp;&nbsp;&nbsp; +</span><br>
  </p>
  <p><br>
  </p>
  <p><br>
  <span style="font-family: monospace;">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Usage of this variable (DB = data
bridge)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MT-DB DB-GEM GEM-DB
DB-MT</span><br style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp; double</span><br
 style="font-family: monospace;">
  <span style="font-family: monospace;">// IC (stoichiometry units)</span><br
 style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp; *bIC,&nbsp;
// bulk mole amounts of
IC[nICb]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
-&nbsp;&nbsp;&nbsp;&nbsp; -</span><br style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp; *rMB,&nbsp;
// Mass balance residuals from GEMIPM [nICb]&nbsp;&nbsp;&nbsp;
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+&nbsp;&nbsp;&nbsp;&nbsp; +</span><br style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp; *uIC,&nbsp;
// IC chemical potentials
(mol/mol)[nICb]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+&nbsp;&nbsp;&nbsp;&nbsp; +</span><br style="font-family: monospace;">
  <span style="font-family: monospace;">// DC (species) in reactive
subsystem</span><br style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp; *xDC,&nbsp;
// DC mole amounts at equilibrium
[nDCb]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (+)&nbsp;&nbsp;&nbsp;
(+)&nbsp;&nbsp;&nbsp;&nbsp; +&nbsp;&nbsp;&nbsp;&nbsp; +</span><br
 style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp; *gam,&nbsp;
// activity coefficients of DC
[nDCb]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
(+)&nbsp;&nbsp;&nbsp; (+)&nbsp;&nbsp;&nbsp;&nbsp;
+&nbsp;&nbsp;&nbsp;&nbsp; +</span><br style="font-family: monospace;">
  <span style="font-family: monospace;">// Metastability/kinetic
controls</span><br style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp; *dul,&nbsp;
// upper kinetic restrictions on xDC [nDCb]&nbsp;&nbsp;&nbsp;&nbsp;
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
-&nbsp;&nbsp;&nbsp;&nbsp; -</span><br style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp; *dll,&nbsp;
// lower kinetic restrictions on xDC [nDCb]&nbsp;&nbsp;&nbsp;&nbsp;
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
-&nbsp;&nbsp;&nbsp;&nbsp; -</span><br style="font-family: monospace;">
  <span style="font-family: monospace;">// Phases in reactive subsystem</span><br
 style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp; *aPH,&nbsp;
// Specific surface areas of phases
(m2/g)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&nbsp;&nbsp;&nbsp;&nbsp; -</span><br
 style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp; *xPH,&nbsp;
// total mole amounts of phases
[nPHb]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+&nbsp;&nbsp;&nbsp;&nbsp; +</span><br style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp; *vPS,&nbsp;
// volumes of phases-solutions, cm3/mol [nPSb]&nbsp;
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+&nbsp;&nbsp;&nbsp;&nbsp; +</span><br style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp; *mPS,&nbsp;
// masses of phases-solutions, g&nbsp;&nbsp;
[nPSb]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+&nbsp;&nbsp;&nbsp;&nbsp; +</span><br style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp; *bPS,&nbsp;
// bulk compositions of phases-solutions</span><br
 style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
//&nbsp;&nbsp;&nbsp;
[nPSb][nICb]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+&nbsp;&nbsp;&nbsp;&nbsp; +</span><br style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp; *xPA,&nbsp;
// amounts of solvent/sorbent in</span><br
 style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
//&nbsp;&nbsp;&nbsp; phases-solutions
[nPSb]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+&nbsp;&nbsp;&nbsp;&nbsp; +</span><br style="font-family: monospace;">
  <span style="font-family: monospace;">// (+) can be used as input in
"smart initial approximation" mode of GEM IPM-2
algorithm&nbsp;&nbsp;&nbsp; </span><br style="font-family: monospace;">
  </p>
  <p><br>
  </p>
  <p><span style="font-family: monospace;">//&nbsp; FMT variables
(units or dimensionsless) - to be used for storing them</span><br
 style="font-family: monospace;">
  <span style="font-family: monospace;">//&nbsp; at the nodearray
level, normally not used in the single-node FMT-GEM coupling</span><br
 style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp; double
Tm,&nbsp;&nbsp;&nbsp;&nbsp; // actual total simulation time, s</span><br
 style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
dt,&nbsp;&nbsp;&nbsp;&nbsp; // actual time step, s</span><br
 style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
Dif,&nbsp;&nbsp;&nbsp; // General diffusivity of disolved matter in the
mode</span><br style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
Vt,&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; // total volume of the node
(voxel), m3</span><br style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
vp,&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; // advection velocity (in
pores) in this node</span><br style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
eps,&nbsp;&nbsp;&nbsp; // effective (actual) porosity normalized to 1</span><br
 style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
Km,&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; // actual permeability, m2</span><br
 style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
Kf,&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; // actual DARCY`s constant,
m2/s</span><br style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
S,&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; // specific storage
coefficient, dimensionless (default 1.0)</span><br
 style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
//&nbsp; if not 1.0 then can be used as mass scaling factor relative to
Ms for the </span><br style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
//&nbsp; bulk composition/speciation of reactive sub-system in this
node </span><br style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
Tr,&nbsp;&nbsp;&nbsp;&nbsp; // transmissivity m2/s</span><br
 style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
h,&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; // actual hydraulic head
(hydraulic potential), m</span><br style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
rho,&nbsp;&nbsp;&nbsp; // actual carrier density for density-driven
flow, g/cm3</span><br style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
al,&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; // specific longitudinal
dispersivity of porous media, m</span><br
 style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
at,&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; // specific transversal
dispersivity of porous media, m</span><br
 style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
av,&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; // specific vertical
dispersivity of porous media, m</span><br
 style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
hDl,&nbsp;&nbsp;&nbsp; // hydraulic longitudinal dispersivity, m2/s,
diffusities from chemical database</span><br
 style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
hDt,&nbsp;&nbsp;&nbsp; // hydraulic transversal dispersivity, m2/s</span><br
 style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
hDv,&nbsp;&nbsp;&nbsp; // hydraulic vertical dispersivity, m2/s</span><br
 style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
nto;&nbsp;&nbsp;&nbsp; // tortuosity factor</span><br>
  <br>
  </p>
  <p>&nbsp;&nbsp; <span style="font-family: monospace;">short</span><br
 style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;
NodeHandle,&nbsp;&nbsp;&nbsp; // Node identification handle</span><br
 style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;
NodeTypeHY,&nbsp;&nbsp;&nbsp; // Node type (hydraulic); see typedef
NODETYPE</span><br style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;
NodeTypeMT,&nbsp;&nbsp;&nbsp; // Node type (mass transport); see
typedef NODETYPE</span><br style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;
NodeStatusFMT, // Node status code FMT; see typedef NODECODEFMT</span><br
 style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;
NodeStatusCH,&nbsp; // Node status code CH;&nbsp; see typedef NODECODECH</span><br
 style="font-family: monospace;">
  <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;
IterDone;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Number of iterations
performed by IPM</span><br>
  </p>
  <p><br>
  </p>
  <h3><a name="TNODE"></a>2.5. The TNode Class - a Minimum Data
Exchange Interface for Coupling with Existing Transport Codes</h3>
  <br>
  <br>
  <h3><a name="TNODEARRAY"></a>2.6. The TNodeArray Class - a Data
Storage for Developing New Coupled Codes </h3>
  <br>
  <h3 style="font-family: Times New Roman,Times,serif;"><a
 name="NUMERICAL_CONTROLS"></a>2.7. Numerical controls of GEMIPM2K
operation</h3>
  <br>
  <p> </p>
  <hr size="2" width="100%">
  <h2><br>
  </h2>
  <h2><a name="REQUIREMENTS"></a>3. Requirements for Programming</h2>
  <p> Geochemical modeling often requires<br>
  </p>
  <p><br>
  <font face="Helvetica, Arial, sans-serif"></font></p>
  <h3 style="font-family: times new roman,times,serif;"><a
 name="CALLFROMCPP"></a>3.1. When the Calling (FMT)
Program is Written in C/C++ </h3>
  <p><br>
  </p>
  <p><font face="Helvetica, Arial, sans-serif"><br>
  </font></p>
  <h3><font style="font-family: times new roman,times,serif;"
 face="Helvetica, Arial, sans-serif"><a name="CALLFROMFORTRAN"></a>3.2.
When the
Calling (FMT) Program is Written in Fortran </font><br>
  </h3>
  <p><br>
  </p>
  <p><br>
  <br>
  </p>
  <hr size="2" width="100%"><br>
  <br>
  <br>
  <p> </p>
  <h2><a name="COMPILE_PLATFORMS"></a>4. Compilation and Linking of
GEMIPM2K on
Various Platforms <br>
  </h2>
  <dl>
  </dl>
  <br>
introduction <br>
  <br>
  <h3 style="font-family: times new roman,times,serif;"><a
 name="GNUCPP_FOR"></a>4.1. GNU C++ (gcc - gfortran)<br>
  </h3>
  <p style="font-family: times new roman,times,serif;"><br>
  </p>
  <h3 style="font-family: times new roman,times,serif;"><a
 name="PGICPP_FOR"></a>4.2. Portland Group C++ (pgcc- pgf)<br>
  </h3>
  <p style="font-family: times new roman,times,serif;"><br>
  </p>
  <h3 style="font-family: times new roman,times,serif;"><a
 name="MSVCPP_DIGIFOR"></a>4.3. MS Visual C++ (with Digital Fortran)<br>
  </h3>
  <p style="font-family: times new roman,times,serif;"><br>
  </p>
  <h3 style="font-family: times new roman,times,serif;"><a
 name="BORLANDCPP"></a>4.4. Borland C++<br>
  </h3>
  <font face="Helvetica, Arial, sans-serif"><br>
  <br>
  </font>
  <h3 style="font-family: times new roman,times,serif;"><a
 name="OTHER_COMPILERS"></a>4.5. Other compilers and linkers</h3>
  <br>
  <font face="Helvetica, Arial, sans-serif"><br>
  </font>
  <h3 style="font-family: times new roman,times,serif;"><a
 name="SVN_REP"></a>4.6. Subversion Repository of GEMIPM2K<br>
  </h3>
  <br>
  <dl>
    <br>
  </dl>
&nbsp; <br>
  <hr size="2" width="100%"><br>
  <h2><a name="INPUT_FILES"></a>5. Input Files <br>
  </h2>
  <p> Geochemical modeling often requires&nbsp; </p>
  <h4><span style="font-family: Helvetica,Arial,sans-serif;"><a
 name="PRODUCE_FILES_S"></a>How to produce GEMIPM2 input text files
from "Single Thermodynamic System" dialog in GEMS-PSI<br>
  </span></h4>
  <p><span style="font-family: Helvetica,Arial,sans-serif;">Select and
load a required SysEq record. Then go to menu "Data"
and then "Write IPM files". In the appearing list of independent
components, mark those you wish to handle in DBR files (or select all)
and click "Ok". In the next list, select dependent components (chemical
species) to be handled in DBR files (or select all) and click "Ok". In
the next list, select phases to be handled in DBR files (or select
all), and press "Ok". Finally, in the appearing file dialog, give a
name to the file set and select a directory (or create a new one) where
to write the files. The GEMIPM2K text files produced in this way are
immediately readable by GEMIPM2K.</span> </p>
&nbsp; <br>
  <hr size="2" width="100%"><br>
  <h2><a name="TEST_EXAMPLES"></a>6. Test Examples <br>
  </h2>
  <p> Geochemical modeling often requires&nbsp; </p>
  <p style="font-family: times new roman,times,serif;"><br>
  </p>
  <h3><font style="font-family: times new roman,times,serif;"
 face="Helvetica, Arial, sans-serif"><a name="TEST_TNODE"></a>6.1.
TNode Level</font></h3>
  <font style="font-family: times new roman,times,serif;"
 face="Helvetica, Arial, sans-serif"></font> <font
 style="font-family: times new roman,times,serif;"
 face="Helvetica, Arial, sans-serif"><br>
  <br>
  </font>
  <h3><font style="font-family: times new roman,times,serif;"
 face="Helvetica, Arial, sans-serif"><a name="TEST_TNODEARRAY"></a>6.2.
TNodeArray Level</font></h3>
  <dl>
    <br style="font-family: times new roman,times,serif;">
    <span style="font-family: times new roman,times,serif;">&nbsp; </span><br>
    <br>
  </dl>
  <hr size="2" width="100%"><br>
  <h2><a name="REFERENCES"></a>7. References</h2>
  <a name="Ref_Bethke-1996"></a> Bethke, 1996 (<a
 href="http://hercules.geology.uiuc.edu/%7Ebethke/hydro_gwb.htm">http://hercules.geology.uiuc.edu/~bethke/hydro_gwb.htm</a>)<br>
  <br>
  <a name="Ref_Bruno_ea_2007"></a> Bruno J.,
Bosbach D., Kulik D., Navrotsky A. (2007): <i>Chemical
thermodynamics of solid solutions of interest in radioactive waste
management: A state-of-the art report</i>, Eds.
F.J.Mompean, M.Illemassene, J.Perrone, Chemical Thermodynamics Series
Vol. <span style="font-weight: bold;">10</span>, Paris, OECD, 292 p.
(<a href="http://www.nea.fr/html/dbtdb/info/publications/welcome.html">http://www.nea.fr/html/dbtdb/info/publications/welcome.html</a>)<br>
  <br>
  <a name="Ref_TM-44-02-06"></a> Chudnenko K.V. et al. TM-44-02-06 <br>
  <br>
  <a name="Ref_Dmytrieva-2008"></a>Dmytrieva S.V. et al. 2008
TM-44-08-XY<br>
  <br>
  <a name="Ref_Karpov-ea-2001"></a> Karpov I.K.,
Chudnenko
K.V., Kulik D.A., Avchenko O.V. and Bychinski V.A. (2001). Minimization
of Gibbs free energy in geochemical systems by convex programming.
Geochemistry International <span style="font-weight: bold;">39</span>(11),
1108-1119. <br>
  <br>
  <a name="Ref_Karpov-ea-1997"></a> Karpov I.K.,
Chudnenko
K.V.
and Kulik D.A. (1997): Modeling chemical mass-transfer in geochemical
processes: Thermodynamic relations, conditions of equilibria and
numerical algorithms.
American Journal of Science <span style="font-weight: bold;">297</span>,
767-806<br>
  <br>
  <a name="Ref_Kulik-ea-2004"></a> Kulik D.,
Berner U., Curti E.
(2004): Modelling chemical equilibrium partitioning with the GEMS-PSI
code. In: PSI Scientific Report 2003 / Volume <span
 style="font-weight: bold;">IV</span>, Nuclear Energy and
Safety (edited by B.Smith and B.Gschwend), Paul Scherrer Institute,
Villigen, Switzerland, March 2004, p.109-122 (ISSN 1423-7334) (<a
 href="http://gems.web.psi.ch/">http://gems.web.psi.ch/</a>)<br>
  <br>
  <a name="Ref_Kulik_ea-2008"></a> Kulik D. et al. (2008) TM-44-08-XX<br>
  <br>
  <a name="Ref_Morel-Hering-1993"></a> Morel and Hering, 1993 <br>
  <br>
  <a name="Ref_Parkhurst-Appelo-1999"></a> Parkhurst and Appelo, 1999 (<a
 href="http://wwwbrr.cr.usgs.gov/projects/GWC_coupled/phreeqc/%29">http://wwwbrr.cr.usgs.gov/projects/GWC_coupled/phreeqc/)</a><br>
  <br>
  <a name="Ref_Reed-1982"></a> Reed, 1982<br>
  <br>
  <a name="Ref_van-der-Lee-1998"></a> van der Lee J. (1998):
Thermodynamic and mathematical concepts of CHESS, Technical Report Nr.
LHM/RD/98/39, Ecole des Mines de Paris, Fontaineleau, France&nbsp; (<a
 href="http://chess.ensmp.fr/doc.html">http://chess.ensmp.fr/doc.html</a>).<br>
  <br>
  <a name="Ref_Van-Zeggeren-1970"></a> Van Zeggeren and Storey,
1970<br>
  <br>
  <br>
  <br>
To
Contents
&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;<tt>About GEMIPM2K </tt><br>
  <tt><br>
end of file</tt> <br>
&nbsp;<br>
  <p><br>
&nbsp; </p>
  <br>
  <br>
</blockquote>
</body>
</html>
